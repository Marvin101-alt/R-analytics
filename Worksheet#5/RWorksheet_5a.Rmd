---
title: "RWorksheet_5a"
author: "Jalando-on, Nandin, Palabrica"
date: "2024-11-27"
output: pdf_document
latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

IMDB

```{r}
library(rvest)
library(dplyr)
library(stringr)
library(polite)
library(kableExtra)
library(knitr)
library(tidyverse)

link = "https://www.imdb.com/chart/toptv/"
page = read_html(link)
session <- bow(link, user_agent = "Educational") 
        session
```

```{r}
nam <- page %>% html_nodes(".ipc-title__text") %>% html_text()
name <- nam[!grepl("Top 250 TV Shows|IMDb Charts|Recently viewed|More to explore", nam, ignore.case = TRUE)]
name
```
```{r}
rank <- str_extract(name, "^\\d+\\.")
rank
```


```{r}
title <- str_replace(name, "^\\d+\\.", "")
title
```


```{r}
yea = page %>% html_nodes(".sc-5bc66c50-6.OOdsw.cli-title-metadata-item") %>% html_text()
year <- str_extract_all(yea, "\\b\\d{4}(?:â€“\\d{4})?\\b") %>% unlist()
year
```


```{r}
rating = page %>% html_nodes(".ipc-rating-star--rating") %>% html_text()
rating
```


```{r}
episode <- page %>% html_nodes(".sc-5bc66c50-6.OOdsw.cli-title-metadata-item") %>%
html_text()
episodes <- str_extract_all(episode, "\\b\\d+ eps\\b") %>% unlist()
episodes
```

```{r}
vote = page %>% html_nodes(".ipc-rating-star--voteCount") %>% html_text()
vote
```
```{r}
urls <- c("https://www.imdb.com/title/tt0903747/?ref_=chttvtp_i_1", 
          "https://www.imdb.com/title/tt5491994/?ref_=chttvtp_i_2",
          "https://www.imdb.com/title/tt0795176/?ref_=chttvtp_i_3",
          "https://www.imdb.com/title/tt0185906/?ref_=chttvtp_i_4",
          "https://www.imdb.com/title/tt7366338/?ref_=chttvtp_i_5",
          "https://www.imdb.com/title/tt0306414/?ref_=chttvtp_i_6",
          "https://www.imdb.com/title/tt0417299/?ref_=chttvtp_i_7",
          "https://www.imdb.com/title/tt6769208/?ref_=chttvtp_i_8",
          "https://www.imdb.com/title/tt0141842/?ref_=chttvtp_i_9",
          "https://www.imdb.com/title/tt2395695/?ref_=chttvtp_i_10",
          "https://www.imdb.com/title/tt0081846/?ref_=chttvtp_i_11",
          "https://www.imdb.com/title/tt9253866/?ref_=chttvtp_i_12",
          "https://www.imdb.com/title/tt0944947/?ref_=chttvtp_i_13",
          "https://www.imdb.com/title/tt7678620/?ref_=chttvtp_i_14",
          "https://www.imdb.com/title/tt0071075/?ref_=chttvtp_i_15",
          "https://www.imdb.com/title/tt1355642/?ref_=chttvtp_i_16",
          "https://www.imdb.com/title/tt2861424/?ref_=chttvtp_i_17",
          "https://www.imdb.com/title/tt1533395/?ref_=chttvtp_i_18",
          "https://www.imdb.com/title/tt8420184/?ref_=chttvtp_i_19",
          "https://www.imdb.com/title/tt0052520/?ref_=chttvtp_i_20",
          "https://www.imdb.com/title/tt1877514/?ref_=chttvtp_i_21",
          "https://www.imdb.com/title/tt1475582/?ref_=chttvtp_i_22",
          "https://www.imdb.com/title/tt2560140/?ref_=chttvtp_i_23",
          "https://www.imdb.com/title/tt0103359/?ref_=chttvtp_i_24",
          "https://www.imdb.com/title/tt0386676/?ref_=chttvtp_i_25")

user_reviews <- vector("numeric", length(urls))
critic_reviews <- vector("numeric", length(urls))
for (i in seq_along(urls)) {

  session <- bow(urls[i], user_agent = "Educational")

  webpage <- scrape(session)

  reviewz <- webpage %>% html_nodes(".score") %>% html_text()

  if (length(reviewz) >= 2) {

    user_reviews[i] <- ifelse(grepl("K", reviewz[1]), 
                              as.numeric(gsub("K", "", reviewz[1])) * 1000, 
                              as.numeric(reviewz[1]))
    critic_reviews[i] <- as.numeric(reviewz[2])
  } else {
    user_reviews[i] <- NA
    critic_reviews[i] <- NA
  }
}
```


```{r}
user_reviews
critic_reviews
```

```{r}
max_length <- max(length(rank), length(title), length(year), length(rating), length(episodes), length(vote))
rank <- c(rank, rep(NA, max_length - length(rank)))
title <- c(title, rep(NA, max_length - length(title)))
year <- c(year, rep(NA, max_length - length(year)))
rating <- c(rating, rep(NA, max_length - length(rating)))
episodes <- c(episodes, rep(NA, max_length - length(episodes)))
vote <- c(vote, rep(NA, max_length - length(vote)))
user_reviews <- c(user_reviews, rep(NA, max_length - length(user_reviews)))
critic_reviews <- c(critic_reviews, rep(NA, max_length - length(critic_reviews)))
max_length
```
```{r}
movies = data.frame(rank, title, year, rating, episodes, vote, user_reviews, critic_reviews, stringsAsFactors = FALSE)
write.csv(movies, "movies.csv")
print(head(movies))
movies %>%
  kable("latex", booktabs = TRUE) %>%
  kable_styling(latex_options = "scale_down")
```
```{r}
link2 = "https://www.imdb.com/title/tt0903747/reviews/?ref_=tt_ov_ql_2"
page2 = read_html(link)
session2 <- bow(link, user_agent = "Educational") 
        session2
```
```{r}
reviews <- page2 %>% html_nodes(".ipc-link--base") %>%  
  html_text()
reviews

```
```{r}
date <- page2 %>% html_nodes(".ipc-inline-list__item.review-date") %>%  
  html_text()
date 

```
```{r}
user_rating <- page2 %>% html_nodes(".sc-a2ac93e5-4.gyibOi") %>%  
  html_text()
user_rating
```


```{r}
link1 = "https://www.imdb.com/chart/toptv/"
page1 = read_html(link)
session1 <- bow(link1, user_agent = "Educational") 
        session1
```

```{r}
user_review = page %>% html_nodes(".score") %>% html_text()
user_review
```
```{r}
library(ggplot2)

movies$year <- as.numeric(movies$year)
year_counts <- movies %>%
  filter(!is.na(year)) %>%
  count(year)

ggplot(year_counts, aes(x = year, y = n)) +
  geom_line(color = "blue") +
  geom_point(color = "red") +
  labs(title = "Number of TV Shows Released by Year",
       x = "Year",
       y = "Number of TV Shows") +
  theme_minimal()

most_releases <- year_counts[which.max(year_counts$n), ]
print(most_releases)
```


**Extracting Amazon Product Reviews**

4. Select 5 categories from Amazon and select 30 products from each category.
```{r}
library(polite)
library(kableExtra)
library(rmarkdown)
library(httr)
library(rvest)
library(dplyr)
library(stringr)
library(ggplot2)
```

```{r}
urls <- c('https://www.amazon.com/s?i=specialty-aps&bbn=16225007011&rh=n%3A16225007011%2Cn%3A172635&ref=nav_em__nav_desktop_sa_intl_printers_0_2_6_11', 'https://www.amazon.com/s?i=specialty-aps&bbn=16225007011&rh=n%3A16225007011%2Cn%3A3011391011&ref=nav_em__nav_desktop_sa_intl_laptop_accessories_0_2_6_7', 'https://www.amazon.com/s?i=specialty-aps&bbn=16225007011&rh=n%3A16225007011%2Cn%3A193870011&ref=nav_em__nav_desktop_sa_intl_computer_components_0_2_6_3', 'https://www.amazon.com/s?i=specialty-aps&bbn=16225007011&rh=n%3A16225007011%2Cn%3A11036071&ref=nav_em__nav_desktop_sa_intl_servers_0_2_6_13', 'https://www.amazon.com/s?i=specialty-aps&bbn=16225007011&rh=n%3A16225007011%2Cn%3A1292115011&ref=nav_em__nav_desktop_sa_intl_monitors_0_2_6_8')

ProductName <- vector("list", length(urls))
price <- vector("list", length(urls))
description <- vector("list", length(urls))
Ratings <- vector("list", length(urls))
Reviews <- vector("list", length(urls))
```


```{r}
df <- list()

 for (i in seq_along(urls)) {
   session <- bow(urls[i], user_agent = "Educational")
   webpage <- scrape(session)
   
ProductName[[i]] <- webpage %>%
  html_nodes('.a-size-base-plus.a-color-base.a-text-normal') %>%
  html_text() %>%
  head(30)

price[[i]] <- webpage %>%
  html_nodes('.a-price-whole') %>%
  html_text() %>%
  head(30)


Ratings[[i]] <- webpage %>%
  html_nodes('.a-icon.a-icon-star-small.a-star-small-4 ') %>%
  html_text() %>%
  head(30)


Reviews[[i]] <-  webpage %>%
  html_nodes('.a-size-base.s-underline-text') %>%
  html_text() %>%
  head(30)
}
```
5. Extract the price, description, ratings and reviews of each product.
```{r}
ProductName
```

```{r}
printer <- data.frame(ProductName[[1]],
                      price = price[[1]],
                      Ratings = Ratings[[1]],
                      stringsAsFactors = FALSE
                      ) 
head(printer, 30)
printer %>% 
  kable("latex", booktabs = TRUE) %>%
  kable_styling(latex_options = "scale_down")
```

```{r}
laptopAccessories <- data.frame(ProductName[[2]],
                      Price = price[[2]],
                      Ratings = Ratings[[2]],
                      stringsAsFactors = FALSE
                      ) 
head(laptopAccessories, 30)

laptopAccessories %>% 
  kable("latex", booktabs = TRUE) %>%
  kable_styling(latex_options = "scale_down")
```

comp <- data.frame(ProductName[[3]],
                      price = price[[3]],
                      Ratings = Ratings[[3]],
                      stringsAsFactors = FALSE
                      ) 
head(comp, 20)
comp %>% 
  kable("latex", booktabs = TRUE) %>%
  kable_styling(latex_options = "scale_down")


Servers <- data.frame(ProductName[[4]],
                      Price = price[[4]],
                      Ratings = ratings[[4]],
                      stringsAsFactors = FALSE
                      ) 
head(Servers, 30)
Servers %>% 
  kable("latex", booktabs = TRUE) %>%
  kable_styling(latex_options = "scale_down")

Monitors <- data.frame(ProductName[[1]],
                      Price = price[[1]],
                      Ratings = ratings[[1]],
                      stringsAsFactors = FALSE
                      ) 
head(Monitors, 50)
Monitors %>% 
  kable("latex", booktabs = TRUE) %>%
  kable_styling(latex_options = "scale_down")
}

h


